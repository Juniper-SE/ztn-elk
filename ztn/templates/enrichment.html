<html>

<head>
    <title>Junos SD Enrichment Form</title>
    <script src="/js/enrichment.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
</head>

<body style="margin:4px;padding:4px">
    This page allows you to make changes to the fields automatically pulled from logs.
    <br/>If you'd like to upload a file with IPs, subnets, users/groups, and zones, you can upload a YAML file. Please follow the format:
    <br/>
        <code>
        ---
        <br/>ad_groups: one,two,three
        <br/>ad_names: natzberg,sandeepr,tvmeter
        <br/>subnets: 192.15.12.0/24,192.15.13.0/24,192.15.14.0/24
        <br/>zones: it,bus,corp
        </code>
    <br/>Please note that uploading a file with the same name will overwrite the old one.
    <hr />

    Upload new file
    <form method=post enctype='multipart/form-data'>
      <input type=file name=file>
      <input type=submit value=Upload>
    </form>

    Already uploaded files
    {% if files %}
    {% for file in files %}
        <code>
           {{ file }}<br/>
        </code>
    {% endfor %}
    {% endif %}

    <input type="checkbox" id="recommended" value="recommended" onchange="useRecommended()">
    <label for="recommended">Use recommended values?</label>

    <form method="post" action="/enrichment/submit">
        <table style="width:500px">
            <tr>
                <td>
                    <label for="sourceaddr">Source address</label>
                </td>
                <td>
                    <select id="sourceaddr" name="sourceaddr" onchange="onChangeSrcAddr()">
                        {% if subnets %}
                        {% for subnet in subnets %}
                        <option value='{{ subnet }}'>{{ subnet }}</option>
                        {% endfor %}
                        {% endif %}
                        <option value='{{ srcaddr }}'>{{srcaddr}}</option>
                        <option name="src_subnet" id="src_subnet" value='{{ srcsubnet }}'>{{srcsubnet}}</option>
                        <input type="number" placeholder="CIDR" style="width:50px" name="src_cidr" id="src_cidr"
                            disabled min="8" max="32">
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="sourceport">Source port</label>
                </td>
                <td>
                    <select name="sourceport" id="sourceport" onchange="onChangeSrcPort()">
                        <option value='{{ srcport }}'>{{srcport}}</option>
                        <option name="srcport_any" value='any'>any</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="destaddr">Destination address</label>
                </td>
                <td>
                    <select id="destaddr" name="destaddr" onchange="onChangeDestAddr()">
                        {% if subnets %}
                        {% for subnet in subnets %}
                        <option value='{{ subnet }}'>{{ subnet }}</option>
                        {% endfor %}
                        {% endif %}
                        <option value='{{ destaddr }}'>{{destaddr}}</option>
                        <option name="dest_subnet" id="dest_subnet" value='{{ destsubnet }}'>{{destsubnet}}</option>
                        <input type="number" placeholder="CIDR" style="width:50px" name="dest_cidr" id="dest_cidr"
                            disabled min="8" max="32">
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="destport">Destination port</label>
                </td>
                <td>
                    <select name="destport" id="destport" onchange="onChangeDestPort()">
                        <option value='{{ destport }}'>{{destport}}</option>
                        <option name="destport_any" value='any'>any</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td>
                    <label for="srczone">Source zone</label>
                </td>
                <td>
                    <select name="srczone" id="srczone" onchange="onChangeSrcZone()">
                        {% if zones %}
                        {% for zone in zones %}
                        <option value='{{ zone }}'>{{ zone }}</option>
                        {% endfor %}
                        {% endif %}
                        <option value='{{ srczone }}' id="log_src_zone">{{srczone}}</option>
                        <option name="srczone_any" value='any'>any</option>
                        <option name="srczone_trust" value='trust'>trust</option>
                        <option name="srczone_untrust" value='untrust'>untrust</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td>
                    <label for="destzone">Destination zone</label>
                </td>
                <td>
                    <select name="destzone" id="destzone" onchange="onChangeDestZone()">
                        {% if zones %}
                        {% for zone in zones %}
                        <option value='{{ zone }}'>{{ zone }}</option>
                        {% endfor %}
                        {% endif %}
                        <option value='{{ destzone }}' id="log_dest_zone">{{destzone}}</option>
                        <option name="destzone_any" value='any'>any</option>
                        <option name="srczone_trust" value='trust'>trust</option>
                        <option name="srczone_untrust" value='untrust'>untrust</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="username">Username or group</label>
                </td>
                <td>
                    <select name="username" id="username" onchange="onChangeUsername()">
                        <option value='{{ username }}' id="log_username">{{username}}</option>
                        {% if ad_groups %}
                        {% for group in ad_groups %}
                        <option value='{{ group }}'>{{ group }}</option>
                        {% endfor %}
                        {% endif %}
                        {% if ad_names %}
                        {% for user in ad_names %}
                        <option value='{{ user }}'>{{ user }}</option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="servicename">Service Name</label>
                </td>
                <td>
                    <select name="servicename" id="servicename" onchange="onChangeApplication()">
                        <option value='{{ servicename }}'>{{servicename}}</option>
                        <option name="servicename_any" value='any'>any</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="application">Application</label>
                </td>
                <td>
                    <select name="application" id="application" onchange="onChangeApplication()">
                        {% if nested_app != "%{nested_app}" %}
                        <option value='{{ nested_app }}'>{{nested_app}}</option>
                        {% elif application != "%{application}" %}
                        <option value='{{ application }}'>{{application}}</option>
                        {% else %}
                        <option value='None'>None</option>
                        {% endif %}
                        <option value='{{ application }}'>{{application}}</option>
                        <option name="application_any" value='any'>any</option>
                        <option value='None'>None</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="policy_name">Policy Name</label>
                </td>
                <td>
                    <input name="policy_name" name="policy_name" type="text" placeholder="ZTN_ELK_POLICY_12345">
                </td>
            </tr>
            <tr>
                <td>
                    <label for="rule_name">Rule Name</label>
                </td>
                <td>
                    <input name="rule_name" id="rule_name" type="text" placeholder="ZTN_ELK_RULE_12345">
                </td>
            </tr>
        </table>
        <input type="hidden" id="protocol_id" name="protocol_id" value="{{ protocol_id }}">
        <button type="submit">Submit enriched form</button>
    </form>

</body>

</html>